<!-- webapp/index.html - ê°„ë‹¨í•œ ì›¹ UI -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kainexa AI Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .main {
            display: flex;
            height: 600px;
        }
        
        .sidebar {
            width: 250px;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .scenario-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .scenario-btn:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }
        
        .content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-area {
            flex: 1;
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 10px;
            max-width: 70%;
        }
        
        .user-message {
            background: #667eea;
            color: white;
            margin-left: auto;
        }
        
        .ai-message {
            background: white;
            border: 1px solid #ddd;
        }
        
        .input-area {
            display: flex;
            gap: 10px;
        }
        
        .input-area input {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
        }
        
        .input-area button {
            padding: 15px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .status {
            padding: 10px;
            background: #e8f5e9;
            border-radius: 10px;
            margin-bottom: 10px;
            display: none;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
        }
        
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ­ Kainexa AI Platform</h1>
            <p>ì œì¡°ì—… íŠ¹í™” AI ì–´ì‹œìŠ¤í„´íŠ¸</p>
        </div>
        
        <div class="main">
            <div class="sidebar">
                <h3>ì‹œë‚˜ë¦¬ì˜¤</h3>
                <button class="scenario-btn" onclick="runScenario('production')">
                    ğŸ“Š ìƒì‚° ëª¨ë‹ˆí„°ë§
                </button>
                <button class="scenario-btn" onclick="runScenario('maintenance')">
                    ğŸ”§ ì˜ˆì¸¡ì  ìœ ì§€ë³´ìˆ˜
                </button>
                <button class="scenario-btn" onclick="runScenario('quality')">
                    âœ… í’ˆì§ˆ ê´€ë¦¬
                </button>
                <button class="scenario-btn" onclick="clearChat()">
                    ğŸ—‘ï¸ ëŒ€í™” ì´ˆê¸°í™”
                </button>
            </div>
            
            <div class="content">
                <div class="status" id="status"></div>
                
                <div class="chat-area" id="chatArea">
                    <div class="message ai-message">
                        ì•ˆë…•í•˜ì„¸ìš”! Kainexa AIì…ë‹ˆë‹¤. ì œì¡°ì—… ê´€ë ¨ ì§ˆë¬¸ì´ë‚˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
                    </div>
                </div>
                
                <div class="input-area">
                    <input type="text" 
                           id="messageInput" 
                           placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
                           onkeypress="if(event.key=='Enter') sendMessage()">
                    <button onclick="sendMessage()">ì „ì†¡</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:8000';
        let conversationId = null;
        
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            addMessage(message, 'user');
            input.value = '';
            
            // API í˜¸ì¶œ
            try {
                showStatus('ì²˜ë¦¬ ì¤‘...', 'info');
                
                const response = await fetch(`${API_BASE}/api/v1/chat`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        message: message,
                        conversation_id: conversationId
                    })
                });
                
                const data = await response.json();
                conversationId = data.conversation_id;
                
                // AI ì‘ë‹µ í‘œì‹œ
                addMessage(data.response, 'ai');
                hideStatus();
                
            } catch (error) {
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }
        
        async function runScenario(type) {
            showStatus(`${type} ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ ì¤‘...`, 'info');
            
            const endpoints = {
                production: '/api/v1/scenarios/production',
                maintenance: '/api/v1/scenarios/maintenance',
                quality: '/api/v1/scenarios/quality'
            };
            
            try {
                const response = await fetch(`${API_BASE}${endpoints[type]}`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                // ê²°ê³¼ë¥¼ ì±„íŒ…ì°½ì— í‘œì‹œ
                let message = formatScenarioResult(type, data);
                addMessage(message, 'ai');
                
                showStatus('ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ!', 'success');
                setTimeout(hideStatus, 3000);
                
            } catch (error) {
                showStatus('ì˜¤ë¥˜: ' + error.message, 'error');
            }
        }
        
        function formatScenarioResult(type, data) {
            if (type === 'production') {
                return `ğŸ“Š ìƒì‚° í˜„í™© ë¶„ì„ ì™„ë£Œ
                
ë‹¬ì„±ë¥ : ${data.data?.total?.achievement_rate || 0}%
ë¶ˆëŸ‰ë¥ : ${data.data?.total?.defect_rate || 0}%
ì´ìŠˆ: ${data.issues?.length || 0}ê±´ ë°œê²¬

${data.report || 'ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'}`;
            } else if (type === 'maintenance') {
                return `ğŸ”§ ì˜ˆì¸¡ì  ìœ ì§€ë³´ìˆ˜ ë¶„ì„ ì™„ë£Œ
                
ì„¤ë¹„: ${data.equipment_id}
ê³ ì¥ í™•ë¥ : ${data.failure_probability}%
ì˜ˆìƒ ì‹œì : ${data.predicted_failure_time}

ê¶Œì¥ ì¡°ì¹˜:
${data.maintenance_schedule?.type || 'ì •ê¸° ì ê²€'}
ì˜ˆì •ì¼: ${data.maintenance_schedule?.recommended_date || 'ë¯¸ì •'}`;
            } else if (type === 'quality') {
                return `âœ… í’ˆì§ˆ ë¶„ì„ ì™„ë£Œ
                
ë¶ˆëŸ‰ë¥ : ${data.summary?.defect_rate || 0}%
Cpk: ${data.summary?.cpk || 0}
íŠ¸ë Œë“œ: ${data.summary?.trend || 'stable'}

ë°œê²¬ëœ íŒ¨í„´:
${data.patterns?.join('\n') || 'íŠ¹ì´ì‚¬í•­ ì—†ìŒ'}`;
            }
            return 'ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ ì™„ë£Œ';
        }
        
        function addMessage(text, type) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.textContent = text;
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }
        
        function clearChat() {
            document.getElementById('chatArea').innerHTML = 
                '<div class="message ai-message">ëŒ€í™”ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”.</div>';
            conversationId = null;
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }
        
        function hideStatus() {
            document.getElementById('status').style.display = 'none';
        }
        
        // ì‹œìŠ¤í…œ ìƒíƒœ ì²´í¬
        async function checkSystem() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/health/full`);
                if (response.ok) {
                    showStatus('ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™ ì¤‘', 'success');
                    setTimeout(hideStatus, 3000);
                }
            } catch (error) {
                showStatus('API ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œì‹œ ì‹œìŠ¤í…œ ì²´í¬
        window.onload = checkSystem;
    </script>
</body>
</html>